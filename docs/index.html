<!DOCTYPE html>
<html lang="en">
<head>
  <title>Fiyat Hesaplama</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">    
</head>
<body>

<div class="container" id="main-div">
  <div id="form-div">
    <br>
    <form onsubmit="return false" id="main-form">      
      <label for="alis-inp">Alış TL</label>
      <input id="alis-inp" type="number" required class="form-control" value="0" step="any" name="alis-inp">
      <label for="kargo-inp">Kargo TL</label>
      <input id="kargo-inp" type="number" required class="form-control" value="0" step="any" name="kargo-inp">
      <label for="paketleme-inp">Paketleme TL</label>
      <input id="paketleme-inp" type="number" required class="form-control" value="0" step="any" name="paketleme-inp">
      <label for="komisyon-yuzdesi-inp">Komisyon %</label>
      <input id="komisyon-yuzdesi-inp" type="number" required class="form-control" value="0" step="any" name="komisyon-yuzdesi-inp">
      <label for="digergider-yuzdesi-inp">Diğer Gider (Satıştan) % (Reklam, İade, Ceza vb.)</label>
      <input id="digergider-yuzdesi-inp" type="number" required class="form-control" value="0" step="any" name="digergider-yuzdesi-inp">
      <label for="alisfaturasi-yuzdesi-inp">Alış Faturası %</label>
      <input id="alisfaturasi-yuzdesi-inp" type="number" required class="form-control" value="0" step="any" name="alisfaturasi-yuzdesi-inp">
      <label for="gelirvergisi-yuzdesi-inp">Gelir Vergisi %</label>
      <input id="gelirvergisi-yuzdesi-inp" type="number" required class="form-control" value="22" step="any" name="gelirvergisi-yuzdesi-inp">
      <label for="kdv-yuzdesi-inp">KDV %</label>
      <input id="kdv-yuzdesi-inp" type="number" required class="form-control" value="18" step="any" name="kdv-yuzdesi-inp">
      <label for="kazanc-yuzdesi-inp">Kazanc (Alıştan) % (Atlamak için Negatif değer giriniz)</label>
      <input id="kazanc-yuzdesi-inp" type="number" required class="form-control" value="0" step="any" name="kazanc-yuzdesi-inp">
      <label for="satis-inp">Satış TL (Atlamak için Negatif değer giriniz)</label>
      <input id="satis-inp" type="number" required class="form-control" value="-1" step="any" name="satis-inp">
      <br>
      <button type="submit" class="btn btn-secondary btn-lg btn-block" form="main-form" id="hesapla-btn">HESAPLA</button>
    </form>  
    <br>  
  </div>   
  <div id="hesapla-div">
    <label for="hesapla-text">Sonuç</label> 
    <textarea id="hesapla-text" class="form-control" rows="16" name="hesapla-text"></textarea>
    <br>
  </div>  
</div>

<script>
(function() {
  'use strict';

  document.addEventListener('DOMContentLoaded', event => {

    let formDiv = document.querySelector('#form-div');
    let mainForm = document.querySelector('#main-form');
    let hesaplaBtn = document.querySelector('#hesapla-btn');
    let hesaplaText = document.querySelector('#hesapla-text');

    /*
    formDiv.addEventListener('click', function() {
      this.scrollIntoView();               
    });  
    */
    
    hesaplaBtn.addEventListener('click', function() {
      if (mainForm.checkValidity()) { 
        hesaplaText.value = '';         
        let alis = Number(document.querySelector('#alis-inp').value);
        let kargo =Number( document.querySelector('#kargo-inp').value);
        let paketleme = Number(document.querySelector('#paketleme-inp').value);
        let komisyonYuzdesi = Number(document.querySelector('#komisyon-yuzdesi-inp').value);
        let digergiderYuzdesi = Number(document.querySelector('#digergider-yuzdesi-inp').value);
        let alisfaturasiYuzdesi = Number(document.querySelector('#alisfaturasi-yuzdesi-inp').value);    
        let gelirvergisiYuzdesi = Number(document.querySelector('#gelirvergisi-yuzdesi-inp').value);
        let kdvYuzdesi = Number(document.querySelector('#kdv-yuzdesi-inp').value); 
        let kazancYuzdesi = Number(document.querySelector('#kazanc-yuzdesi-inp').value);
        let satis = Number(document.querySelector('#satis-inp').value);  
        
        if (kazancYuzdesi >= 0 && satis < 0) {          
          //satis = (  alis*kazancYuzdesi/100 + alis+kargo+paketleme - (alis*alisfaturasiYuzdesi/100+kargo+paketleme)*gelirvergisiYuzdesi/100 - (alis*alisfaturasiYuzdesi/100+kargo+paketleme)*(1-1/(1+kdvYuzdesi/100)) ) / ( 1 - komisyonYuzdesi/100 - digergiderYuzdesi/100 - (1/(1+kdvYuzdesi/100))*gelirvergisiYuzdesi/100 + (komisyonYuzdesi/100+digergiderYuzdesi/100)*gelirvergisiYuzdesi/100 - (1-1/(1+kdvYuzdesi/100))  + (komisyonYuzdesi/100+digergiderYuzdesi/100)*(1-1/(1+kdvYuzdesi/100)) );
        
          //satis = kazanc + gider + gelirvergisi + kdv;          
          //satis = 
          //      alis*kazancYuzdesi/100 + 
          //      alis + kargo + paketleme + komisyon + digergider + 
          //      ((satis - giderFaturasi)/(1 + kdvYuzdesi/100))*gelirvergisiYuzdesi/100 + 
          //      (satis - giderFaturasi)*(1 - 1/(1 + kdvYuzdesi/100))
          //      ;  
          //satis = 
          //      alis*kazancYuzdesi/100 + 
          //      alis + kargo + paketleme + satis*komisyonYuzdesi/100 + satis*digergiderYuzdesi/100 + 
          //      ((satis - (alis*alisfaturasiYuzdesi/100 + kargo + paketleme + satis*komisyonYuzdesi/100 + satis*digergiderYuzdesi/100))/(1 + kdvYuzdesi/100))*gelirvergisiYuzdesi/100 + 
          //      (satis - (alis*alisfaturasiYuzdesi/100 + kargo + paketleme + satis*komisyonYuzdesi/100 + satis*digergiderYuzdesi/100))*(1 - 1/(1 + kdvYuzdesi/100))
          //      ;
          //satis = 
          //      alis*kazancYuzdesi/100 + 
          //      alis + kargo + paketleme + satis*komisyonYuzdesi/100 + satis*digergiderYuzdesi/100 + 
          //      (satis*(1 - (komisyonYuzdesi/100 + digergiderYuzdesi/100))/(1 + kdvYuzdesi/100))*gelirvergisiYuzdesi/100 - ((alis*alisfaturasiYuzdesi/100 + kargo + paketleme)/(1 + kdvYuzdesi/100))*gelirvergisiYuzdesi/100 + 
          //      satis*(1 - (komisyonYuzdesi/100 + digergiderYuzdesi/100))*(1 - 1/(1 + kdvYuzdesi/100)) - (alis*alisfaturasiYuzdesi/100 + kargo + paketleme)*(1 - 1/(1 + kdvYuzdesi/100))
          //      ;
          satis = 
                (  alis*kazancYuzdesi/100 + alis + kargo + paketleme - ((alis*alisfaturasiYuzdesi/100 + kargo + paketleme)/(1 + kdvYuzdesi/100))*gelirvergisiYuzdesi/100 - (alis*alisfaturasiYuzdesi/100 + kargo + paketleme)*(1 - 1/(1 + kdvYuzdesi/100))    )  /
                (  (1 - komisyonYuzdesi/100 - digergiderYuzdesi/100 - ((1 - (komisyonYuzdesi/100 + digergiderYuzdesi/100))/(1 + kdvYuzdesi/100))*gelirvergisiYuzdesi/100 - (1 - (komisyonYuzdesi/100 + digergiderYuzdesi/100))*(1 - 1/(1 + kdvYuzdesi/100)))  )
                ;                 
        } else if (kazancYuzdesi < 0 && satis >= 0) {          
        } else {
          return;
        }
                
        let komisyon = 0, digergider = 0, gider = 0, giderFaturasi = 0, gelirvergisi = 0, kdv = 0, kazanc = 0;
        
        komisyon = satis*komisyonYuzdesi/100;
        digergider = satis*digergiderYuzdesi/100;        
        gider = alis + kargo + paketleme + komisyon + digergider;
        giderFaturasi = alis*alisfaturasiYuzdesi/100 + kargo + paketleme + komisyon + digergider;
        gelirvergisi = ((satis - giderFaturasi)/(1 + kdvYuzdesi/100))*gelirvergisiYuzdesi/100;
        kdv = (satis - giderFaturasi)*(1 - 1/(1 + kdvYuzdesi/100)); 
        kazanc = satis - gider - gelirvergisi - kdv;       
        
        hesaplaText.value += 'Alış: ' + '\t\t\t\t' + alis.toFixed(2) + ' TL' + '\r\n';
        hesaplaText.value += 'Kargo: ' + '\t\t\t' + kargo.toFixed(2) + ' TL' + '\r\n';
        hesaplaText.value += 'Paketleme: ' + '\t\t' + paketleme.toFixed(2) + ' TL' + '\r\n';
        hesaplaText.value += 'Komisyon: ' + '\t\t' + komisyon.toFixed(2) + ' TL' + '\r\n';
        hesaplaText.value += 'Diğer Gider: ' + '\t\t' + digergider.toFixed(2) + ' TL' + '\r\n';
        hesaplaText.value += '------------------------------------------------------' + '\r\n';
        hesaplaText.value += 'GİDER: ' + '\t\t\t' + gider.toFixed(2) + ' TL' + '\r\n';
        hesaplaText.value += 'FATURALI GİDER: ' + '\t' + giderFaturasi.toFixed(2) + ' TL' + '\r\n';        
        hesaplaText.value += 'GELİR VERGİSİ: ' + '\t' + gelirvergisi.toFixed(2) + ' TL' + '\r\n';
        hesaplaText.value += 'KDV: ' + '\t\t\t' + kdv.toFixed(2) + ' TL' + '\r\n';
        hesaplaText.value += '------------------------------------------------------' + '\r\n';
        hesaplaText.value += 'SATIŞ: ' + '\t\t\t' + satis.toFixed(2) + ' TL' + '\r\n';
        hesaplaText.value += 'ALIŞ: ' + '\t\t\t' + alis.toFixed(2) + ' TL' + '\r\n';        
        hesaplaText.value += 'KAZANÇ: ' + '\t\t' + kazanc.toFixed(2) + ' TL' + '\r\n';
        hesaplaText.value += 'KAZANÇ YÜZDESİ: ' + '\t' + (100*kazanc/alis).toFixed(2) + ' %  (ALIŞTAN)' + '\r\n';
        
            
      } 
    });   
    
  });
})();
</script>

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
</body>
</html>
